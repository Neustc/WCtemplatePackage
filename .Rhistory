p1
p1  <-  ggplot ( Ngarnai_fem , aes ( Any_part , EBV_NV )) +
geom_line (aes(y = EBV_NV, colour = "EBV_NV"),group=1)+
geom_line(aes(y = Nats_vius/30,colour = "Nacidos vivos"),group=2)+
# Creeu un eix secundari simple
scale_y_continuous (sec.axis = sec_axis ( ~  .  *  30, name="Nacidos vivos" ))+
#modifying colours and theme options
scale_colour_manual(values = c("blue", "orange"))+
labs(title=" Blup reproductivo y nacidos vivos", y = "EBV nacidos vivos",
x = "Año parto",
colour = "")+
theme(legend.position = c(0.8, 0.2))
p1
p1  <-  ggplot ( Ngarnai_fem , aes ( Any_part , EBV_NV )) +
geom_line (aes(y = EBV_NV, colour = "EBV_NV"),group=1)+
geom_line(aes(y = Nats_vius/30,colour = "Nacidos vivos"),group=2)+
# Creeu un eix secundari simple
scale_y_continuous (sec.axis = sec_axis ( ~  .  *  30, name="Nacidos vivos" ))+
#modifying colours and theme options
scale_colour_manual(values = c("blue", "orange"))+
labs(title=" Blup reproductivo y nacidos vivos", y = "EBV nacidos vivos",
x = "Año parto",
colour = "")+
theme(legend.position = c(0.8, 0.2))
p1
p1  <-  ggplot ( Ngarnai_fem , aes ( Any_part , EBV_NV )) +
geom_line (aes(y = EBV_NV, colour = "EBV_NV"),group=1)+
geom_line(aes(y = Nats_vius/18,colour = "Nacidos vivos"),group=2)+
# Creeu un eix secundari simple
scale_y_continuous (sec.axis = sec_axis ( ~  .  *  18, name="Nacidos vivos" ))+
#modifying colours and theme options
scale_colour_manual(values = c("blue", "orange"))+
labs(title=" Blup reproductivo y nacidos vivos", y = "EBV nacidos vivos",
x = "Año parto",
colour = "")+
theme(legend.position = c(0.8, 0.2))
p1
p<-  ggplot ( Ngarnai_fem , aes ( Any_part , EBV_NV )) +
geom_line (aes(y = EBV_NV, colour = "EBV_NV"),group=1)+
geom_line(aes(y = Nats_vius/18,colour = "Nacidos vivos"),group=2)+
# Creeu un eix secundari simple
scale_y_continuous (sec.axis = sec_axis ( ~  .  *  18, name="Nacidos vivos" ),limits=c(7,10))+
#modifying colours and theme options
scale_colour_manual(values = c("blue", "orange"))+
labs(title=" Blup reproductivo y nacidos vivos", y = "EBV nacidos vivos",
x = "Año parto",
colour = "")+
theme(legend.position = c(0.8, 0.2))
p
p<-  ggplot ( Ngarnai_fem , aes ( Any_part , EBV_NV )) +
geom_line (aes(y = EBV_NV, colour = "EBV_NV"),group=1)+
geom_line(aes(y = Nats_vius/18,colour = "Nacidos vivos"),group=2)+
# Creeu un eix secundari simple
scale_y_continuous (sec.axis = sec_axis ( ~  .  *  18, name="Nacidos vivos" ))+
#modifying colours and theme options
scale_colour_manual(values = c("blue", "orange"))+
labs(title=" Blup reproductivo y nacidos vivos", y = "EBV nacidos vivos",
x = "Año parto",
colour = "")+
theme(legend.position = c(0.8, 0.2))
p
p<-  ggplot ( Ngarnai_fem , aes ( Any_part , EBV_NV )) +
geom_line (aes(y = EBV_NV, colour = "EBV_NV"),group=1)+
geom_line(aes(y = Nats_vius/18,colour = "Nacidos vivos"),group=2, lims(7,10))+
# Creeu un eix secundari simple
scale_y_continuous (sec.axis = sec_axis ( ~  .  *  18, name="Nacidos vivos" ))+
#modifying colours and theme options
scale_colour_manual(values = c("blue", "orange"))+
labs(title=" Blup reproductivo y nacidos vivos", y = "EBV nacidos vivos",
x = "Año parto",
colour = "")+
theme(legend.position = c(0.8, 0.2))
p
p<-  ggplot ( Ngarnai_fem , aes ( Any_part , EBV_NV )) +
geom_line (aes(y = EBV_NV, colour = "EBV_NV"),group=1)+
geom_line(aes(y = Nats_vius/18,colour = "Nacidos vivos"),group=2,lims=c(7,10))+
# Creeu un eix secundari simple
scale_y_continuous (sec.axis = sec_axis ( ~  .  *  18, name="Nacidos vivos" ))+
#modifying colours and theme options
scale_colour_manual(values = c("blue", "orange"))+
labs(title=" Blup reproductivo y nacidos vivos", y = "EBV nacidos vivos",
x = "Año parto",
colour = "")+
theme(legend.position = c(0.8, 0.2))
p
p<-  ggplot ( Ngarnai_fem , aes ( Any_part , EBV_NV )) +
geom_line (aes(y = EBV_NV, colour = "EBV_NV"),group=1)+
geom_line(aes(y = Nats_vius/18,colour = "Nacidos vivos"),group=2,lim=c(7,10))+
# Creeu un eix secundari simple
scale_y_continuous (sec.axis = sec_axis ( ~  .  *  18, name="Nacidos vivos" ))+
#modifying colours and theme options
scale_colour_manual(values = c("blue", "orange"))+
labs(title=" Blup reproductivo y nacidos vivos", y = "EBV nacidos vivos",
x = "Año parto",
colour = "")+
theme(legend.position = c(0.8, 0.2))
p
p<-  ggplot ( Ngarnai_fem , aes ( Any_part , EBV_NV )) +
geom_line (aes(y = EBV_NV, colour = "EBV_NV"),group=1)+
geom_line(aes(y = Nats_vius/18,colour = "Nacidos vivos"),group=2,lims=c(7,9))+
# Creeu un eix secundari simple
scale_y_continuous (sec.axis = sec_axis ( ~  .  *  18, name="Nacidos vivos" ))+
#modifying colours and theme options
scale_colour_manual(values = c("blue", "orange"))+
labs(title=" Blup reproductivo y nacidos vivos", y = "EBV nacidos vivos",
x = "Año parto",
colour = "")+
theme(legend.position = c(0.8, 0.2))
p
p<-  ggplot ( Ngarnai_fem , aes ( Any_part , EBV_NV )) +
geom_line (aes(y = EBV_NV, colour = "EBV_NV"),group=1)+
geom_line(aes(y = Nats_vius/18,colour = "Nacidos vivos"),group=2)+
# Creeu un eix secundari simple
scale_y_continuous (sec.axis = sec_axis ( ~  .  *  18, name="Nacidos vivos" ),lims=c(7,9))+
#modifying colours and theme options
scale_colour_manual(values = c("blue", "orange"))+
labs(title=" Blup reproductivo y nacidos vivos", y = "EBV nacidos vivos",
x = "Año parto",
colour = "")+
theme(legend.position = c(0.8, 0.2))
p
p<-  ggplot ( Ngarnai_fem , aes ( Any_part , EBV_NV )) +
geom_line (aes(y = EBV_NV, colour = "EBV_NV"),group=1)+
geom_line(aes(y = Nats_vius/18,colour = "Nacidos vivos"),group=2)+
# Creeu un eix secundari simple
scale_y_continuous (sec.axis = sec_axis ( ~  .  *  18, name="Nacidos vivos" ),lims(7,9))+
#modifying colours and theme options
scale_colour_manual(values = c("blue", "orange"))+
labs(title=" Blup reproductivo y nacidos vivos", y = "EBV nacidos vivos",
x = "Año parto",
colour = "")+
theme(legend.position = c(0.8, 0.2))
p
p<-  ggplot ( Ngarnai_fem , aes ( Any_part , EBV_NV )) +
geom_line (aes(y = EBV_NV, colour = "EBV_NV"),group=1)+
geom_line(aes(y = Nats_vius/18,colour = "Nacidos vivos"),group=2)+
# Creeu un eix secundari simple
scale_y_continuous (sec.axis = sec_axis ( ~  .  *  18, name="Nacidos vivos" ),limits(7,9))+
#modifying colours and theme options
scale_colour_manual(values = c("blue", "orange"))+
labs(title=" Blup reproductivo y nacidos vivos", y = "EBV nacidos vivos",
x = "Año parto",
colour = "")+
theme(legend.position = c(0.8, 0.2))
p
p<-  ggplot ( Ngarnai_fem , aes ( Any_part , EBV_NV )) +
geom_line (aes(y = EBV_NV, colour = "EBV_NV"),group=1)+
geom_line(aes(y = Nats_vius/18,colour = "Nacidos vivos"),group=2)+
# Creeu un eix secundari simple
scale_y_continuous (sec.axis = sec_axis ( ~  .  *  18, name="Nacidos vivos" ),limits=c(7,9))+
#modifying colours and theme options
scale_colour_manual(values = c("blue", "orange"))+
labs(title=" Blup reproductivo y nacidos vivos", y = "EBV nacidos vivos",
x = "Año parto",
colour = "")+
theme(legend.position = c(0.8, 0.2))
p
p<-  ggplot ( Ngarnai_fem , aes ( Any_part , EBV_NV )) +
geom_line (aes(y = EBV_NV, colour = "EBV_NV"),group=1)+
geom_line(aes(y = Nats_vius/18,colour = "Nacidos vivos"),group=2)+
# Creeu un eix secundari simple
scale_y_continuous (sec.axis = sec_axis ( ~  .  *  18, name="Nacidos vivos" ),limits=c(7,9))+
#modifying colours and theme options
scale_colour_manual(values = c("blue", "orange"))+
labs(title=" Blup reproductivo y nacidos vivos", y = "EBV nacidos vivos",
x = "Año parto",
colour = "")+
theme(legend.position = c(0.8, 0.2))
p
p<-  ggplot ( Ngarnai_fem , aes ( Any_part , EBV_NV )) +
geom_line (aes(y = EBV_NV, colour = "EBV_NV"),group=1)+
geom_line(aes(y = Nats_vius/18,colour = "Nacidos vivos", limits=c(7,9)),group=2)+
# Creeu un eix secundari simple
scale_y_continuous (sec.axis = sec_axis ( ~  .  *  18, name="Nacidos vivos" ))+
#modifying colours and theme options
scale_colour_manual(values = c("blue", "orange"))+
labs(title=" Blup reproductivo y nacidos vivos", y = "EBV nacidos vivos",
x = "Año parto",
colour = "")+
theme(legend.position = c(0.8, 0.2))
p
p<-  ggplot ( Ngarnai_fem , aes ( Any_part , EBV_NV )) +
geom_line (aes(y = EBV_NV, colour = "EBV_NV"),group=1)+
geom_line(aes(y = Nats_vius/18,colour = "Nacidos vivos"),group=2)+
# Creeu un eix secundari simple
scale_y_continuous (sec.axis = sec_axis ( ~  .  *  18, name="Nacidos vivos" ))+
#modifying colours and theme options
scale_colour_manual(values = c("blue", "orange"))+
labs(title=" Blup reproductivo y nacidos vivos", y = "EBV nacidos vivos",
x = "Año parto",
colour = "")+
theme(legend.position = c(0.8, 0.2))
p
p<-  ggplot ( Ngarnai_fem , aes ( Any_part , EBV_NV )) +
geom_line (aes(y = EBV_NV, colour = "EBV_NV"),group=1)+
geom_line(aes(y = Nats_vius/9*0.5,colour = "Nacidos vivos"),group=2)+
# Creeu un eix secundari simple
scale_y_continuous (sec.axis = sec_axis ( ~  .  *  9/0.5, name="Nacidos vivos" ))+
#modifying colours and theme options
scale_colour_manual(values = c("blue", "orange"))+
labs(title=" Blup reproductivo y nacidos vivos", y = "EBV nacidos vivos",
x = "Año parto",
colour = "")+
theme(legend.position = c(0.8, 0.2))
p
p<-  ggplot ( Ngarnai_fem , aes ( Any_part , EBV_NV )) +
geom_line (aes(y = EBV_NV, colour = "EBV_NV"),group=1)+
geom_line(aes(y = Nats_vius/9*0.5,colour = "Nacidos vivos"),group=2)+
# Creeu un eix secundari simple
scale_y_continuous (sec.axis = sec_axis ( ~  .  *  9/0.5, name="Nacidos vivos" ))+
#modifying colours and theme options
scale_colour_manual(values = c("blue", "orange"))+
labs(title=" Blup reproductivo y nacidos vivos", y = "EBV nacidos vivos",
x = "Año parto",
colour = "")+
theme(legend.position = c(0.8, 0.2))
p
p<-  ggplot ( Ngarnai_fem , aes ( Any_part , EBV_NV )) +
geom_line (aes(y = EBV_NV, colour = "EBV_NV"),group=1)+
geom_line(aes(y = Nats_vius/9*0.5,colour = "Nacidos vivos"),group=2)+
# Creeu un eix secundari simple
scale_y_continuous (sec.axis = sec_axis ( ~  .  *  9/0.5, name="Nacidos vivos" ))+
#modifying colours and theme options
scale_colour_manual(values = c("blue", "orange"))+
labs(title=" Blup reproductivo y nacidos vivos", y = "EBV nacidos vivos",
x = "Año parto",
colour = "")+
theme(legend.position = c(0.8, 0.2))
p
p<-  ggplot ( Ngarnai_fem , aes ( Any_part , EBV_NV )) +
geom_line (aes(y = EBV_NV, colour = "EBV_NV"),group=1)+
geom_line(aes(y = Nats_vius/18,colour = "Nacidos vivos"),group=2)+
# Creeu un eix secundari simple
scale_y_continuous (sec.axis = sec_axis ( ~  .  *  18, name="Nacidos vivos" ),
limits = c(0.2, 1))+
#modifying colours and theme options
scale_colour_manual(values = c("blue", "orange"))+
labs(title=" Blup reproductivo y nacidos vivos", y = "EBV nacidos vivos",
x = "Año parto",
colour = "")+
theme(legend.position = c(0.8, 0.2))
p
p<-  ggplot ( Ngarnai_fem , aes ( Any_part , EBV_NV )) +
geom_line (aes(y = EBV_NV, colour = "EBV_NV"),group=1)+
geom_line(aes(y = Nats_vius/18,colour = "Nacidos vivos"),group=2)+
# Creeu un eix secundari simple
scale_y_continuous (sec.axis = sec_axis ( ~  .  *  18, name="Nacidos vivos" ),
limits = c(0.3, 0.5))+
#modifying colours and theme options
scale_colour_manual(values = c("blue", "orange"))+
labs(title=" Blup reproductivo y nacidos vivos", y = "EBV nacidos vivos",
x = "Año parto",
colour = "")+
theme(legend.position = c(0.8, 0.2))
p
p<-  ggplot ( Ngarnai_fem , aes ( Any_part , EBV_NV )) +
geom_line (aes(y = EBV_NV, colour = "EBV_NV"),group=1)+
geom_line(aes(y = Nats_vius/18,colour = "Nacidos vivos"),group=2)+
# Creeu un eix secundari simple
scale_y_continuous (sec.axis = sec_axis ( ~  .  *  18, name="Nacidos vivos" ),
limits = c(0, 0.5))+
#modifying colours and theme options
scale_colour_manual(values = c("blue", "orange"))+
labs(title=" Blup reproductivo y nacidos vivos", y = "EBV nacidos vivos",
x = "Año parto",
colour = "")+
theme(legend.position = c(0.8, 0.2))
p
View(Ngarnai_fem)
p<-  ggplot ( Ngarnai_fem , aes ( Any_part , EBV_NV )) +
geom_line (aes(y = EBV_NV, colour = "EBV_NV"),group=1)+
geom_line(aes(y = Nats_vius/18,colour = "Nacidos vivos"),group=2)+
# Creeu un eix secundari simple
scale_y_continuous (sec.axis = sec_axis ( ~  .  *  18, name="Nacidos vivos" ),
limits = c(0.28, 0.52))+
#modifying colours and theme options
scale_colour_manual(values = c("blue", "orange"))+
labs(title=" Blup reproductivo y nacidos vivos", y = "EBV nacidos vivos",
x = "Año parto",
colour = "")+
theme(legend.position = c(0.8, 0.2))
p
p<-  ggplot ( Ngarnai_fem , aes ( Any_part , EBV_NV )) +
geom_line (aes(y = EBV_NV, colour = "EBV_NV"),group=1)+
geom_line(aes(y = Nats_vius/18,colour = "Nacidos vivos"),group=2)+
# Creeu un eix secundari simple
scale_y_continuous (sec.axis = sec_axis ( ~  .  *  18, name="Nacidos vivos" ))+
#modifying colours and theme options
scale_colour_manual(values = c("blue", "orange"))+
labs(title=" Blup reproductivo y nacidos vivos", y = "EBV nacidos vivos",
x = "Año parto",
colour = "")+
theme(legend.position = c(0.8, 0.2))
p
#filtrar per raça, empresa, parts de les femelles
parts_fem<-filter(porcs_empreses_garrinada_Blupr, CODRAC=="55",DESEMP=="UPB GENETIC WORLD", SEXE=="F",!is.na(DATPAR))
parts_fem<-mutate(parts_fem, ANYPART=format(DATPAR, "%Y"))
Ngarnai<-filter(parts_fem,ANYPART>2016, CODGRA=="UD")%>%select(CODGRA, TATUATGE,Sexe=SEXE,ANYPART, garrinades=GARNAI.y,NASTOT)
Ngarnai<-group_by(Ngarnai,ANYPART, CODGRA) %>% summarise(garrinades=n(), Nats_vius=mean(NASTOT))
Nfem<-filter(parts_fem,ANYPART>2016, CODGRA=="UD")%>% select(TATUATGE,CODGRA,VG,ANYPART)%>%distinct(TATUATGE,VG,CODGRA,ANYPART)%>%group_by(ANYPART,CODGRA)%>%summarise(TATUATGE=n(),VG=mean(VG))
Ngarnai_fem<-left_join(Ngarnai,Nfem)
Ngarnai_fem<-select(Ngarnai_fem,Granja=CODGRA, Any_part=ANYPART, Garrinades=garrinades,Nats_vius,N_femelles=TATUATGE,EBV_NV=VG)
p<-  ggplot ( Ngarnai_fem , aes ( Any_part , EBV_NV )) +
geom_line (aes(y = EBV_NV, colour = "EBV_NV"),group=1)+
geom_line(aes(y = Nats_vius/18,colour = "Nacidos vivos"),group=2)+
# Creeu un eix secundari simple
scale_y_continuous (sec.axis = sec_axis ( ~  .  *  18, name="Nacidos vivos" ))+
#modifying colours and theme options
scale_colour_manual(values = c("blue", "orange"))+
labs(title=" Blup reproductivo y nacidos vivos", y = "EBV nacidos vivos",
x = "Año parto",
colour = "")+
theme(legend.position = c(0.8, 0.2))
p
p<-  ggplot ( Ngarnai_fem , aes ( Any_part , EBV_NV )) +
geom_line (aes(y = EBV_NV, colour = "EBV_NV"),group=1)+
geom_line(aes(y = Nats_vius/15,colour = "Nacidos vivos"),group=2)+
# Creeu un eix secundari simple
scale_y_continuous (sec.axis = sec_axis ( ~  .  *  15, name="Nacidos vivos" ))+
#modifying colours and theme options
scale_colour_manual(values = c("blue", "orange"))+
labs(title=" Blup reproductivo y nacidos vivos", y = "EBV nacidos vivos",
x = "Año parto",
colour = "")+
theme(legend.position = c(0.8, 0.2))
p
p<-  ggplot ( Ngarnai_fem , aes ( Any_part , EBV_NV )) +
geom_line (aes(y = EBV_NV, colour = "EBV_NV"),group=1)+
geom_line(aes(y = Nats_vius,colour = "Nacidos vivos"),group=2)+
# Creeu un eix secundari simple
scale_y_continuous (sec.axis = sec_axis ( name="Nacidos vivos" ))+
#modifying colours and theme options
scale_colour_manual(values = c("blue", "orange"))+
labs(title=" Blup reproductivo y nacidos vivos", y = "EBV nacidos vivos",
x = "Año parto",
colour = "")+
theme(legend.position = c(0.8, 0.2))
p
p<-  ggplot ( Ngarnai_fem , aes ( Any_part , EBV_NV )) +
geom_line (aes(y = EBV_NV, colour = "EBV_NV"),group=1)+
geom_line(aes(y = Nats_vius,colour = "Nacidos vivos"),group=2)+
# Creeu un eix secundari simple
scale_y_continuous (sec.axis = sec_axis ( name="Nacidos vivos" ))+
#modifying colours and theme options
scale_colour_manual(values = c("blue", "orange"))+
labs(title=" Blup reproductivo y nacidos vivos", y = "EBV nacidos vivos",
x = "Año parto",
colour = "")+
theme(legend.position = c(0.8, 0.2))
p
Nfem<-filter(parts_fem,ANYPART>2016, CODGRA=="UD")%>% select(TATUATGE,CODGRA,VG,ANYPART)%>%distinct(TATUATGE,VG,CODGRA,ANYPART)%>%group_by(ANYPART,CODGRA)%>%summarise(TATUATGE=n(),VG=mean(VG))
Ngarnai_fem<-left_join(Ngarnai,Nfem)
Ngarnai_fem<-select(Ngarnai_fem,Granja=CODGRA, Any_part=ANYPART, Garrinades=garrinades,Nats_vius,N_femelles=TATUATGE,EBV_NV=VG)
p<-  ggplot ( Ngarnai_fem , aes ( Any_part , EBV_NV )) +
geom_line (aes(y = EBV_NV, colour = "EBV_NV"),group=1)+
geom_line(aes(y = Nats_vius,colour = "Nacidos vivos"),group=2)+
# Creeu un eix secundari simple
scale_y_continuous (sec.axis = sec_axis ( name="Nacidos vivos" ))+
#modifying colours and theme options
scale_colour_manual(values = c("blue", "orange"))+
labs(title=" Blup reproductivo y nacidos vivos", y = "EBV nacidos vivos",
x = "Año parto",
colour = "")+
theme(legend.position = c(0.8, 0.2))
p
p<-  ggplot ( Ngarnai_fem , aes ( Any_part , EBV_NV )) +
geom_line (aes(y = EBV_NV, colour = "EBV_NV"),group=1)+
geom_line(aes(y = Nats_vius/18,colour = "Nacidos vivos"),group=2)+
# Creeu un eix secundari simple
scale_y_continuous (sec.axis = sec_axis ( ~  .  *  18, name="Nacidos vivos" ))+
#modifying colours and theme options
scale_colour_manual(values = c("blue", "orange"))+
labs(title=" Blup reproductivo y nacidos vivos", y = "EBV nacidos vivos",
x = "Año parto",
colour = "")+
theme(legend.position = c(0.8, 0.2))
p
p<-  ggplot ( Ngarnai_fem , aes ( Any_part , EBV_NV )) +
geom_line (aes(y = EBV_NV, colour = "EBV_NV"),group=1)+
geom_line(aes(y = Nats_vius/25,colour = "Nacidos vivos"),group=2)+
# Creeu un eix secundari simple
scale_y_continuous (sec.axis = sec_axis ( ~  .  *  25, name="Nacidos vivos" ))+
#modifying colours and theme options
scale_colour_manual(values = c("blue", "orange"))+
labs(title=" Blup reproductivo y nacidos vivos", y = "EBV nacidos vivos",
x = "Año parto",
colour = "")+
theme(legend.position = c(0.8, 0.2))
p
p<-  ggplot ( Ngarnai_fem , aes ( Any_part , EBV_NV )) +
geom_line (aes(y = EBV_NV, colour = "EBV_NV"),group=1)+
geom_line(aes(y = Nats_vius/25,colour = "Nacidos vivos"),group=2, limits = c(8.5, 9.5))+
# Creeu un eix secundari simple
scale_y_continuous (sec.axis = sec_axis ( ~  .  *  25, name="Nacidos vivos" ))+
#modifying colours and theme options
scale_colour_manual(values = c("blue", "orange"))+
labs(title=" Blup reproductivo y nacidos vivos", y = "EBV nacidos vivos",
x = "Año parto",
colour = "")+
theme(legend.position = c(0.8, 0.2))
p
quit()
quit()
#buscar camades dels testats
testats_IA_nlotes<-group_by(testats_emp,DATFI,DATCOB)%>%summarise(DATCOB=n())%>% group_by(DATFI) %>% summarise(DATCOB=n())
#buscar camades dels testats
testats_IA_nlotes<-group_by(testats_emp,DATFI,DATCOB)%>%summarise(DATCOB=n())%>% group_by(DATFI) %>% summarise(DATCOB=n())
testats_IA_dias<-group_by(testats_emp,DATFI)%>%summarise(maxDATCOB=max(DATCOB),minDATCOB=min(DATCOB),DIESDATCOB=(maxDATCOB)-(minDATCOB))
testats_IA_nlotes_dias<-merge(testats_IA_nlotes,testats_IA_dias,by="DATFI")%>%select(DATFI,N_lotes_IA=DATCOB,Intervalo=DIESDATCOB)
testats_IA_ncamades_NV_TD<-group_by(testats_emp,DATFI,GARNAI.x)%>%summarise(GARNAI.x,NASVIUFEM,NASVIUMAS,DEST_TOTALES) %>% distinct(DATFI,GARNAI.x,NASVIUFEM,NASVIUMAS,DEST_TOTALES)%>%
group_by(DATFI)%>% summarise(Ncam=(GARNAI.x=n()),NV_F=(sum(NASVIUFEM)),NV_M=(sum(NASVIUMAS)),TD=(sum(DEST_TOTALES)))
testats_IA_lotes_camadas<-merge(testats_IA_nlotes_dias,testats_IA_ncamades_NV_TD,by="DATFI")
testats_IA_nlotes<-group_by(testats_emp,DATFI,DATCOB)%>%summarise(DATCOB=n())%>% group_by(DATFI) %>% summarise(DATCOB=n())
library(RODBC)
library(foreign)
library(doBy)
library(nadiv)
library(tidyverse)
library(ggplot2)
library(kableExtra)
##########################################################################
DB_read_only   <- odbcConnect("SICCP", uid="consiccp", pwd="consiccp")
##########################################################################
porcs  <- sqlQuery(DB_read_only,"select * FROM PORCS")
empreses <-sqlQuery(DB_read_only,"select * FROM GRANJA")
test  <- sqlQuery(DB_read_only,"select * FROM TEST")
garri  <- sqlQuery(DB_read_only,"select * FROM GARRINADA")
#unir porcs i empreses
porcs_empreses<-merge(porcs, empreses,by=("CODGRA"))
#Crear Camp granja origen animals
porcs_empreses<-mutate(porcs_empreses,CODGRA_ORIGEN=substr(TATUATGE, start = 1, stop = 2))
# filtrar per empresa i raça
porcs_empresa<-filter(porcs_empreses, CODRAC=="55",DESEMP=="CEFUSA")
#unir amb test
porcs_testats<-merge(porcs_empresa, test,by.x=c("TATUATGE","ANYNAI"),by.y=c("TATUATGE","ANYNAI"))
porcs_testats<-mutate(porcs_testats, ANYTEST=format(DATFI, "%Y"))
#unir amb garrinada
porcs_testats_garri<-merge(porcs_testats,garri,by.x=c("TATMAR","DATNAI"),by.y=c("TATMAR","DATPAR"))
#crear EDAD_FIN
porcs_testats_garri<-mutate(porcs_testats_garri,EDAD_FIN=round((DATFI)-(DATNAI),digits=1))
porcs_testats_garri$EDAD_FIN <- as.numeric(porcs_testats_garri$EDAD_FIN)
testats_emp<-select(porcs_testats_garri,TATUATGE,ANYNAI,DATNAI,DATCOB,GARNAI.x,NASTOT,NASVIUFEM,NASVIUMAS,DEST_TOTALES,CODRAC,
DESEMP, SEXE,ANYTEST,DATFI,PESFI,GREFI,LOMO,GIM,EDAD_FIN)
#testats_emp<-filter(testats_emp,ANYTEST>= 2020)
testats_emp[,"SEXE"] <-as.character(ifelse( testats_emp[,"SEXE"]== "F","H", testats_emp[,"SEXE"]))
testats_emp[,"DATFI"] <-format(as.Date(as.character(testats_emp[,"DATFI"]))  ,"%d-%m-%Y")
testats_emp_datfi <- testats_emp %>% group_by(DATFI,SEXE) %>%
summarise(N=(TATUATGE=n()),
PESO_FIN_M  = mean(PESFI, na.rm = TRUE) ,
PESO_FIN_SD = sd(PESFI, na.rm = TRUE),
ETD_FIN_M  = mean(GREFI, na.rm = TRUE) ,
ETD_FIN_SD = sd(GREFI, na.rm = TRUE),
EDAD_FIN_M  = mean(EDAD_FIN, na.rm = TRUE) ,
EDAD_FIN_SD = sd(EDAD_FIN, na.rm = TRUE),
LOMO_M  = mean(LOMO, na.rm = TRUE) ,
LOMO_SD = sd(LOMO, na.rm = TRUE))
testats_emp_datfi$DATFI <- lubridate::dmy(testats_emp_datfi$DATFI)
testats_emp_datfi<-arrange(testats_emp_datfi,DATFI)
testats_emp_datfitaula<-testats_emp_datfi
names(x = testats_emp_datfitaula) <-c("Fecha Fin (lote)","Sexo","N","M","(SD)","M","(SD)","M","(SD)","M","(SD)")
knitr::kable(testats_emp_datfitaula , booktabs=T, digits=1)%>%
add_header_above(c(" "=3,"PESO_FIN"=2,"ETD_FIN"=2,"LOMO"=2, "EDAD_FIN"=2))%>%
kableExtra::kable_styling(latex_options= c("striped",stripe_index=c(1:2,5:6,9:10,13:14),"scale_down","HOLD_position"))%>%
column_spec(5,7,9,11, width="0.8cm")
#buscar camades dels testats
testats_IA_nlotes<-group_by(testats_emp,DATFI,DATCOB)%>%summarise(DATCOB=n())%>% group_by(DATFI) %>% summarise(DATCOB=n())
testats_IA_nlotes<-group_by(testats_emp,DATFI,DATCOB)%>%summarise(DATCOB=n())%>% group_by(DATFI) %>% summarise(DATCOB=n())
testats_IA_dias<-group_by(testats_emp,DATFI)%>%summarise(maxDATCOB=max(DATCOB),minDATCOB=min(DATCOB),DIESDATCOB=(maxDATCOB)-(minDATCOB))
testats_IA_nlotes_dias<-merge(testats_IA_nlotes,testats_IA_dias,by="DATFI")%>%select(DATFI,N_lotes_IA=DATCOB,Intervalo=DIESDATCOB)
testats_IA_ncamades_NV_TD<-group_by(testats_emp,DATFI,GARNAI.x)%>%summarise(GARNAI.x,NASVIUFEM,NASVIUMAS,DEST_TOTALES) %>% distinct(DATFI,GARNAI.x,NASVIUFEM,NASVIUMAS,DEST_TOTALES)%>%
group_by(DATFI)%>% summarise(Ncam=(GARNAI.x=n()),NV_F=(sum(NASVIUFEM)),NV_M=(sum(NASVIUMAS)),TD=(sum(DEST_TOTALES)))
testats_IA_lotes_camadas<-merge(testats_IA_nlotes_dias,testats_IA_ncamades_NV_TD,by="DATFI")
#Buscar camades de IA
Ngarrinad_datcob<-select(testats_emp,DESEMP,CODRAC, DATCOB,DATFI)%>%distinct()
ncamadas<-merge(porcs_empresa, garri, by.x=c("TATUATGE","ANYNAI"),by.y=c("TATMAR","ANYMAR"))
Ngarrinad_datcob_garri<-merge(ncamadas,Ngarrinad_datcob, by="DATCOB",all.y = TRUE)%>%select(DATFI,DATCOB,GARNAI.x,NASVIUFEM,NASVIUMAS,DEST_TOTALES)%>%
group_by(DATFI)%>% summarise(Ncam_LOTE_IA=(GARNAI.x=n()),NV_F_LOTE_IA=sum(NASVIUFEM),NV_M_LOTE_IA=sum(NASVIUMAS),TD_LOTE_IA=(sum(DEST_TOTALES)))
LOTE_FI_LOTE_IA<-merge(testats_IA_lotes_camadas,Ngarrinad_datcob_garri,by="DATFI")
LOTE_FI_LOTE_IA$DATFI <- lubridate::dmy(LOTE_FI_LOTE_IA$DATFI)
LOTE_FI_LOTE_IA$DATFI[,"DATFI"] <-format(as.Date(as.character(LOTE_FI_LOTE_IA$DATFI[,"DATFI"]))  ,"%d-%m-%Y")
LOTE_FI_LOTE_IA<-arrange(LOTE_FI_LOTE_IA,DATFI)
knitr::kable(LOTE_FI_LOTE_IA , booktabs=T, digits=1)%>%
kable_styling(latex_options= c("striped",stripe_index=c(1,3,5,6),"scale_down"))
#Buscar camades de IA
Ngarrinad_datcob<-select(testats_emp,DESEMP,CODRAC, DATCOB,DATFI)%>%distinct()
ncamadas<-merge(porcs_empresa, garri, by.x=c("TATUATGE","ANYNAI"),by.y=c("TATMAR","ANYMAR"))
Ngarrinad_datcob_garri<-merge(ncamadas,Ngarrinad_datcob, by="DATCOB",all.y = TRUE)%>%select(DATFI,DATCOB,GARNAI.x,NASVIUFEM,NASVIUMAS,DEST_TOTALES)%>%
group_by(DATFI)%>% summarise(Ncam_LOTE_IA=(GARNAI.x=n()),NV_F_LOTE_IA=sum(NASVIUFEM),NV_M_LOTE_IA=sum(NASVIUMAS),TD_LOTE_IA=(sum(DEST_TOTALES)))
LOTE_FI_LOTE_IA<-merge(testats_IA_lotes_camadas,Ngarrinad_datcob_garri,by="DATFI")
LOTE_FI_LOTE_IA$DATFI <- lubridate::dmy(LOTE_FI_LOTE_IA$DATFI)
LOTE_FI_LOTE_IA<-arrange(LOTE_FI_LOTE_IA,DATFI)
knitr::kable(LOTE_FI_LOTE_IA , booktabs=T, digits=1)%>%
kable_styling(latex_options= c("striped",stripe_index=c(1,3,5,6),"scale_down"))
knitr::kable(LOTE_FI_LOTE_IA , booktabs=T, digits=1)%>%
kable_styling(latex_options= c("striped",stripe_index=c(1,3,5,6),"scale_down"))
footnote(general= "N: Número de animales; M (DS) Media (Desviación Estándar); PFC: peso a fin de control (kg); GFC: media de grasa (mm) al final de control (mm); EFC: edad al final del control (días); N_Lotes IA (Int): número de lotes de IA con animales en el control (intervalo entre las fechas de IA en días); N_cam: número de camadas de las que se controlan animales; NV: nacidos vivos, machos y hembras, procedentes de dichas camadas; DT: destetados totales en dichas camadas; Ncam_lote: número total de camadas en el lote de IA; NV_lote: total de nacidos vivos del total de las camadas en el lote de IA; ND_lote: destetados totales del lote.", threeparttable=T)
knitr::kable(LOTE_FI_LOTE_IA , booktabs=T, digits=1)%>%
kable_styling(latex_options= c("striped",stripe_index=c(1,3,5,6),"scale_down"))
footnote(general= "PESO_FIN: peso a fin de control (Kg); ETD_FIN: espesor tocino dorsal (mm) a fin de control; ETD_100: espesor tocino dorsal a los 100 kg (mm); EDAD_FIN: edad a fin de control (dias); EDAD_100: edad a los 100 Kg (días);GMD: índice de crecimiento diario (gr/día) entre el nacimiento y fecha final de control; LOMO: lomo  al fin de control; EBV_GMD: valor genètico del  crecimiento; EBV_ETD: valor genético del tocino dorsal; EBV_NV: valor genètico de nacidos vivos; INDICE_NV_Cre:Índice genético (76% NV + 24% GMD) ; INDICE_REPRO_PRO: Índice genético (10% NV + 15% GMD + 75% ETD)", threeparttable=T)
knitr::kable(LOTE_FI_LOTE_IA , booktabs=T, digits=1)%>%
kableExtra:: kable_styling(latex_options= c("striped",stripe_index=c(1,3,5,6),"scale_down"))
footnote(general= "PESO_FIN: peso a fin de control (Kg); ETD_FIN: espesor tocino dorsal (mm) a fin de control; ETD_100: espesor tocino dorsal a los 100 kg (mm); EDAD_FIN: edad a fin de control (dias); EDAD_100: edad a los 100 Kg (días);GMD: índice de crecimiento diario (gr/día) entre el nacimiento y fecha final de control; LOMO: lomo  al fin de control; EBV_GMD: valor genètico del  crecimiento; EBV_ETD: valor genético del tocino dorsal; EBV_NV: valor genètico de nacidos vivos; INDICE_NV_Cre:Índice genético (76% NV + 24% GMD) ; INDICE_REPRO_PRO: Índice genético (10% NV + 15% GMD + 75% ETD)", threeparttable=T)
knitr::kable(LOTE_FI_LOTE_IA , booktabs=T, digits=1)%>%
kable_styling(latex_options= c("striped",stripe_index=c(1,3,5,6),"scale_down"))%>%
footnote(general= "N: Número de animales; M (DS) Media (Desviación Estándar); PFC: peso a fin de control (kg); GFC: media de grasa (mm) al final de control (mm); EFC: edad al final del control (días); N_Lotes IA (Int): número de lotes de IA con animales en el control (intervalo entre las fechas de IA en días); N_cam: número de camadas de las que se controlan animales; NV: nacidos vivos, machos y hembras, procedentes de dichas camadas; DT: destetados totales en dichas camadas; Ncam_lote: número total de camadas en el lote de IA; NV_lote: total de nacidos vivos del total de las camadas en el lote de IA; ND_lote: destetados totales del lote.", threeparttable=T)
knitr::kable(testats_emp_datfitaula , booktabs=T, digits=1)%>%
add_header_above(c(" "=3,"PESO_FIN"=2,"ETD_FIN"=2,"LOMO"=2, "EDAD_FIN"=2))%>%
kableExtra::kable_styling(latex_options= c("striped",stripe_index=c(1:2,5:6,9:10,13:14),"scale_down","HOLD_position"))%>%
column_spec(5,7,9,11, width="0.8cm")
quit()
devtools::install_github('Neustc/WCtemplatePackage')
setwd("C:/RepTemplates/WCtemplatePackage")
